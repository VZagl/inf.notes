# [git - Как убрать коммиты от слова совсем?](https://ru.stackoverflow.com/questions/1531915/Как-убрать-коммиты-от-слова-совсем)

## вопрос:

Вот такая ситуация. Примерная история коммитов с комментариями.

- Нормальный коммит, запушен на `github`
- Нормальный коммит
- Коммит, в который случайно попал новый файл на 200 мегабайт
- Очередной коммит.
- Коммит, в котором замечена неприятность, файл удален через `git rm`
- Еще один коммит

Но теперь если пушить все это на `github`, то получается неприятность: большой файл там не принимается, и хотя его вроде бы и нет в коммите 5 и далее, но он есть в коммитах 3 и 4, и хотя он не нужен в принципе, пуш его все равно пытается залить.

Как корректно поступить в такой ситуации? Конечно, как вариант - откат к коммиту 2, и добавление все наново руками, что было в коммитах 3 и 4. Но не кажется хорошим решением. А как поступить лучше всего?

## ответ:

> **Совет: _Вместо хэшей удобнее использовать теги._**

Переделываете историю, избавляясь от коммитов, относящихся к проблемным файлам

```bash
git rebase --onto <последний нормальный коммит> <коммит, в который случайно попал новый файл> <oчередной коммит>
```

Затем устанавливаете ветку на новый oчередной коммит и пушите. Коммит 1813bf5e873ae3a7fc0ccb2f96cc7b0547f7b759 будет выпилен полностью.

```bash
git checkout c776ffc36977b52f8e497e90f03c9591b98c6ac3
git rebase --onto c776ffc36977b52f8e497e90f03c9591b98c6ac3 1813bf5e873ae3a7fc0ccb2f96cc7b0547f7b759 874eb211adc6706f0626ff66db4d1092cdc3b72c
(возможно тут попросит разрулить правку version 2 / 3)
git branch -f main
git push origin main
```

Если `<Коммит, в который случайно попал новый файл>` нужно сохранить без этого файла, то cначала переключаетесь на этот коммит, удаляете файл и делаете изменения `git commit --amend`, а потом перенос уже с этим отредактированным коммитом. Модифицированный коммит 1813bf5e873ae3a7fc0ccb2f96cc7b0547f7b759 останется, но без большого файла.

```bash
git checkout 1813bf5e873ae3a7fc0ccb2f96cc7b0547f7b759
git rm large.rar
git commit --amend
(Закрываете редактор комментария коммита без правок. Получаете новый коммит 2-alt.)
git rebase --onto 2-alt-id 1813bf5e873ae3a7fc0ccb2f96cc7b0547f7b759 874eb211adc6706f0626ff66db4d1092cdc3b72c
git branch -f main
git push origin main
```

<hr>
<hr>

## [3.6 Ветвление в Git - Перебазирование](https://git-scm.com/book/ru/v2/%D0%92%D0%B5%D1%82%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2-Git-%D0%9F%D0%B5%D1%80%D0%B5%D0%B1%D0%B0%D0%B7%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)

Смотреть `Более интересные перемещения`.

### так было:

![так было](https://git-scm.com/book/ru/v2/images/interesting-rebase-1.png)

### так стало 1:

![так стало 1](https://git-scm.com/book/ru/v2/images/interesting-rebase-2.png)

### так стало 2:

![так стало 2](https://git-scm.com/book/ru/v2/images/interesting-rebase-4.png)

### так стало 3:

![так стало 3](https://git-scm.com/book/ru/v2/images/interesting-rebase-5.png)

<hr>
<hr>

## Удаление коммитов в Git

Иногда возникает необходимость полностью удалить один или несколько коммитов из истории Git. Это может быть полезно, если в коммит случайно попали конфиденциальные данные или ненужные изменения. Рассмотрим несколько способов решения этой задачи.

### 1. Удаление последнего коммита

Если нужно удалить только последний коммит, можно использовать команду `git reset`.

#### Команда:

```bash
git reset --hard HEAD~1
```

#### Объяснение:

- `HEAD~1` указывает на предыдущий коммит.
- Флаг `--hard` удаляет изменения из рабочей директории и индекса.

> **Важно:** Все изменения, которые были в последнем коммите, будут потеряны.

---

### 2. Удаление нескольких последних коммитов

Если нужно удалить несколько последних коммитов, можно указать количество коммитов, которые нужно удалить:

#### Команда:

```bash
git reset --hard HEAD~N
```

#### Объяснение:

- Замените `N` на количество коммитов, которые нужно удалить.

---

### 3. Удаление коммитов из середины истории

Для удаления коммитов из середины истории используется интерактивный ребейз.

#### Команда:

```bash
git rebase -i HEAD~N
```

#### Объяснение:

- Замените `N` на количество последних коммитов, которые хотите отредактировать.
- В открывшемся редакторе найдите строку с коммитом, который нужно удалить, и замените `pick` на `drop`.
- Сохраните изменения и закройте редактор.

---

### 4. Полное удаление коммитов из удаленного репозитория

После удаления коммитов локально нужно обновить удаленный репозиторий.

#### Команда:

```bash
git push origin --force
```

#### Объяснение:

- Флаг `--force` перезаписывает историю в удаленном репозитории.
- Используйте с осторожностью, так как это может повлиять на других разработчиков.

---

### 5. Удаление коммитов с помощью фильтрации

> `filter-repo` это отдельная программа, которую нужно установить в систему.

Если нужно удалить коммиты, содержащие определенные файлы или данные, можно использовать `git filter-repo` (или устаревшую команду `git filter-branch`).

#### Пример команды:

```bash
git filter-repo --path файл_для_удаления --invert-paths
```

#### Объяснение:

- Удаляет все упоминания указанного файла из истории.

> **Примечание:** Перед использованием этой команды рекомендуется сделать резервную копию репозитория.

---

### Заключение

Удаление коммитов в Git — это мощный инструмент, который требует осторожности. Перед выполнением любых операций, изменяющих историю, рекомендуется создать резервную копию репозитория. Также важно помнить, что изменение истории может повлиять на других участников команды.
