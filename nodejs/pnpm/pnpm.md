# Конспект по pnpm

## Что такое pnpm?

**pnpm** — это быстрый, эффективный и дисковое пространство-экономящий менеджер пакетов для Node.js. Он является альтернативой npm и Yarn.

## Основные особенности

- **Жесткие ссылки:** pnpm использует жесткие ссылки для хранения пакетов, что экономит место на диске.
- **Высокая скорость:** благодаря кэшированию и параллельной установке пакетов.
- **Изоляция зависимостей:** каждая зависимость устанавливается только один раз и используется всеми проектами.
- **Совместимость с npm:** поддерживает большинство команд и форматов npm.

## Установка

### Через npm (стандартный способ)

```bash
npm install -g pnpm
```

### Через Corepack (рекомендуемый способ)

Corepack - это инструмент, встроенный в Node.js с версии 16.13, который позволяет управлять менеджерами пакетов.

1. Включение Corepack:

```bash
corepack enable
```

2. Включение поддержки pnpm:

```bash
corepack enable pnpm
```

3. Подготовка pnpm:

```bash
corepack prepare pnpm@latest --activate
```

> [!NOTE] Примечание:
>
> - Для Node.js версии ниже 16.13, сначала установите Corepack:
>
> ```bash
> npm install -g corepack
> ```
>
> - Команда `corepack enable pnpm` активирует только поддержку pnpm
> - После выполнения `enable pnpm` нужно обязательно выполнить `prepare`
> - Можно указать конкретную версию: `corepack prepare pnpm@8.x --activate`
> - Для быстрого переключения между версиями используйте команду `use`:
>
>   ```bash
>   corepack use pnpm@latest-10
>   ```
>
>   Эта команда автоматически загрузит и активирует указанную версию pnpm
>   Это добавит поле "packageManager" в ваш локальный package.json, которое будет инструктировать Corepack всегда использовать определенную версию в этом проекте.
>
>   Чтобы вернуться к глобально установленной версии pnpm, удалите поле "packageManager" из package.json или выполните команду:
>
>   ```bash
>   corepack disable pnpm
>   ```
>
>   После этого проект будет использовать версию pnpm, установленную через `corepack prepare`.

Преимущества установки через Corepack:

- Автоматическое управление версиями пакетных менеджеров
- Согласованность версий в команде
- Встроенная поддержка в Node.js
- Возможность переключения между версиями pnpm

## Основные команды

| Команда                 | Описание                          |
| ----------------------- | --------------------------------- |
| `pnpm install`          | Установить все зависимости        |
| `pnpm add <pkg>`        | Добавить пакет                    |
| `pnpm remove <pkg>`     | Удалить пакет                     |
| `pnpm update`           | Обновить зависимости              |
| `pnpm install -g <pkg>` | Глобальная установка пакета       |
| `pnpm list`             | Список установленных пакетов      |
| `pnpm run <script>`     | Запустить npm-скрипт              |
| `pnpm exec <cmd>`       | Выполнить команду из зависимостей |

### `pnpm exec`

Команда `pnpm exec` позволяет запускать бинарные файлы, установленные в зависимостях проекта, без необходимости указывать полный путь.

**Пример использования:**

```bash
pnpm exec eslint src/
```

Это выполнит `eslint`, установленный в вашем проекте.

## Работа с монорепозиториями

pnpm поддерживает работу с монорепозиториями через [Workspaces](https://pnpm.io/workspaces).

**Пример `pnpm-workspace.yaml`:**

```yaml
packages:
	- 'packages/*'
	- 'libs/*'
```

## Кэширование

- Все пакеты кэшируются в одной директории (`~/.pnpm-store`).
- Повторная установка происходит мгновенно.

## Конфигурация

Настройки можно задать в `.npmrc` или через команду:

```bash
pnpm config set <key> <value>
```

## Преимущества pnpm

- Экономия места на диске.
- Быстрая установка.
- Легкая интеграция с CI/CD.
- Совместимость с экосистемой npm.

## Полезные ссылки

- [Официальный сайт](https://pnpm.io/)
